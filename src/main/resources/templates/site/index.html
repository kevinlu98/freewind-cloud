<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!--/*@thymesVar id="site" type="cn.kevinlu98.cloud.freewindcloud.common.Website"*/-->
<head th:replace="common::head"><title></title></head>

<body>
<div id="loading">
    <div id="loading-center">
    </div>
</div>
<!--/*@thymesVar id="loginUser" type="cn.kevinlu98.cloud.freewindcloud.pojo.User"*/-->
<div class="wrapper" th:with="loginUser=${#authentication.principal.loginUser}">

    <div th:replace="common::sidebar"></div>
    <div th:replace="common::navbar"></div>

    <div class="content-page">
        <div class="container-fluid">
            <div th:replace="common::message"></div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="iq-edit-list-data">
                        <div class="tab-content">
                            <div class="tab-pane fade active show" id="personal-information" role="tabpanel">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between">
                                        <div class="iq-header-title">
                                            <h4 class="card-title">站点设置</h4>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <form th:action="@{/site/save/}" method="post">
                                            <div class=" row align-items-center">
                                                <div class="col-sm-6">
                                                    <div class="form-group col-sm-12">
                                                        <label>站点标题:</label>
                                                        <input type="text" class="form-control"
                                                               th:value="${site.title()}" name="title" required>
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>站点关键词:</label>
                                                        <input type="text" class="form-control"
                                                               th:value="${site.keywords()}" name="keywords" required>
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>站点描述:</label>
                                                        <textarea class="form-control" name="desc" required
                                                                  th:text="${site.desc()}"></textarea>
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>站点favicon:</label>
                                                        <img style="border-radius: 3px;margin-left: 10px;cursor: pointer;"
                                                             data-input="favicon-file" id="favicon-img"
                                                             class="lw-upload-img crm-profile-pic avatar-50 shadow border-primary"
                                                             th:src="${site.icon()}" alt="profile-pic" src="">
                                                        <input class="file-upload" type="file" id="favicon-file"
                                                               data-hidden="favicon-hidden" data-img="favicon-img"
                                                               accept="image/*">
                                                        <input type="hidden" class="form-control" id="favicon-hidden"
                                                               th:value="${site.icon()}" name="icon" required>
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>站点图标(正常):</label>
                                                        <img style="border-radius: 3px;width: 200px;margin-left: 10px;background-color:#fff;cursor: pointer"
                                                             class="lw-upload-img crm-profile-pic shadow"
                                                             id="logo-normal-img" data-input="logo-normal-file"
                                                             th:src="${site.logoBlank()}" alt="profile-pic" src="">
                                                        <input class="file-upload" type="file" id="logo-normal-file"
                                                               data-hidden="logo-normal-hidden"
                                                               data-img="logo-normal-img"
                                                               accept="image/*">
                                                        <input type="hidden" class="form-control"
                                                               id="logo-normal-hidden"
                                                               th:value="${site.logoBlank()}" name="logo_blank"
                                                               required>
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>站点图标(暗色):</label>
                                                        <img style="border-radius: 3px;width: 200px;background-color:#121212;margin-left: 10px;cursor: pointer"
                                                             id="logo-an-img" data-input="logo-an-file"
                                                             class="lw-upload-img crm-profile-pic shadow"
                                                             th:src="${site.logoWhite()}" alt="profile-pic" src="">
                                                        <input class="file-upload" type="file" id="logo-an-file"
                                                               data-hidden="logo-an-hidden" data-img="logo-an-img"
                                                               accept="image/*">
                                                        <input type="hidden" class="form-control" id="logo-an-hidden"
                                                               th:value="${site.logoWhite()}" name="logo_white"
                                                               required>
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>允许用户上传头像大小:</label>
                                                        <input class="form-control" name="avatar_size" required
                                                               type="text"
                                                               th:value="${T(cn.kevinlu98.cloud.freewindcloud.common.enums.Size).BTrim.convert(site.avatarSize())}">
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>用户默认空间大小:</label>
                                                        <input class="form-control" name="default_max_size" required
                                                               type="text"
                                                               th:value="${T(cn.kevinlu98.cloud.freewindcloud.common.enums.Size).BTrim.convert(site.defaultMaxSize())}">
                                                    </div>
                                                    <div class="form-group col-sm-12">
                                                        <label>用户上传大小限制:</label>
                                                        <input class="form-control" name="upload_limit" required
                                                               type="text"
                                                               th:value="${T(cn.kevinlu98.cloud.freewindcloud.common.enums.Size).BTrim.convert(site.uploadLimit())}">
                                                    </div>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary mr-2">确认更新</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="common::footer"></div>
<div th:include="common::script"></div>
<div th:replace="common::modal"></div>
<script>
    $(function () {
        $(".file-upload").on('change', function () {
            let csrf = $("#spring-csrf");
            let formData = new FormData();
            formData.append("file", this.files[0])
            formData.append(csrf.attr("name"), csrf.val())
            $.ajax({
                url: "/site/upload",
                type: "post",
                dataType: "json",
                cache: false,
                data: formData,
                processData: false,// 不处理数据
                contentType: false, // 不设置内容类型
                success: res => {
                    if (res.success) {
                        $(`#${$(this).data('hidden')}`).val(res.data)
                        $(`#${$(this).data('img')}`).attr('src', res.data)
                    }
                }
            })
        })

        $(".lw-upload-img").on('click', function () {
            let target = $(this).data('input')
            $(`#${target}`).click()
        })
    })
</script>
</body>
</html>
